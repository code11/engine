"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1133],{4522:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>a});var t=n(7250),i=n(9596);const r={id:"testing",title:"Testing",sidebar_label:"Testing"},c=void 0,o={id:"testing",title:"Testing",description:"Engine gives a lot of emphasis to building testable applications. Recommended",source:"@site/docs/testing.md",sourceDirName:".",slug:"/testing",permalink:"/engine/docs/testing",draft:!1,unlisted:!1,editUrl:"https://github.com/code11/engine/edit/master/docs/docs/testing.md",tags:[],version:"current",frontMatter:{id:"testing",title:"Testing",sidebar_label:"Testing"},sidebar:"docs",previous:{title:"Triggers",permalink:"/engine/docs/patterns/triggers"},next:{title:"Modules",permalink:"/engine/docs/modules/engine"}},d={},a=[{value:"Testing <code>producer</code>s",id:"testing-producers",level:2},{value:"<code>Test.producer</code>",id:"testproducer",level:3},{value:"Testing <code>view</code>s",id:"testing-views",level:2},{value:"<strong><code>Test.view</code></strong>",id:"testview",level:3}];function l(e){const s={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.p,{children:["Engine gives a lot of emphasis to building testable applications. Recommended\nway to test Engine applications is using ",(0,t.jsx)(s.code,{children:"@c11/engine.test"})," package, which can\nbe installed like any other npm package."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-sh",children:"npm install -D @c11/engine.test jest\nyarn add -D @c11/engine.test jest\n"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"@c11/engine.test"})," provides utilities for writing tests which can be used with\nthe ",(0,t.jsx)(s.a,{href:"https://jestjs.io/",children:"jest"})," testing framework. Jest is the only Engine supported\ntesting framework for now."]}),"\n",(0,t.jsxs)(s.p,{children:["Engine applications are combinations of ",(0,t.jsx)(s.a,{href:"/docs/api/view",children:"views"})," and\n",(0,t.jsx)(s.a,{href:"/docs/api/producer",children:"producers"}),". Naturally, unit testing Engine applications is\nachieved by writing unit tests for its ",(0,t.jsx)(s.code,{children:"producer"}),"s and ",(0,t.jsx)(s.code,{children:"view"}),"s."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:'import Test from "@c11/engine.test";\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Like rest of Engine ecosystem, API exposed by ",(0,t.jsx)(s.code,{children:"@c11/engine.test"})," is also quite\nminimal. Default export from ",(0,t.jsx)(s.code,{children:"@c11/engine.test"})," has just 2 properties which can\nbe used to test ",(0,t.jsx)(s.a,{href:"/docs/api/producer",children:"producer"}),"s and ",(0,t.jsx)(s.a,{href:"/docs/api/view",children:"view"}),"s."]}),"\n",(0,t.jsxs)(s.h2,{id:"testing-producers",children:["Testing ",(0,t.jsx)(s.code,{children:"producer"}),"s"]}),"\n",(0,t.jsxs)(s.p,{children:["Engine ",(0,t.jsx)(s.code,{children:"producer"}),"s are just Javascript functions. Testing them boils down to\nsame rules that apply to testing functions. Only catch is the fact that it is\nnot possible to call producers directly. They are executed by\n",(0,t.jsx)(s.a,{href:"/docs/api/engine",children:"Engine"})," automatically when something interesting in state\nchanges. ",(0,t.jsx)(s.code,{children:"Test.producer"})," is a convenience function which works around this\ncatch, and makes testing a breeze."]}),"\n",(0,t.jsx)(s.h3,{id:"testproducer",children:(0,t.jsx)(s.code,{children:"Test.producer"})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"Test.producer"})," is a replacement for\n",(0,t.jsx)(s.a,{href:"https://jestjs.io/docs/en/api#testname-fn-timeout",children:"test/it"})," calls. A call to\n",(0,t.jsx)(s.code,{children:"Test.producer"})," tests a single attribute (or function call) of a producer,\nmaking a single test case for a producer's test suite. For example, here's what\na test suite for a producer with single test looks like:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:'describe("editListItem", () => {\n  Test.producer("Guard action doesn\'t exist", {\n    producer: editListItem,\n    values: {},\n    expectations: {\n      resetAction: {\n        set: [],\n      },\n      updateMode: {\n        set: [],\n      },\n    },\n  });\n});\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Unlike ",(0,t.jsx)(s.a,{href:"https://jestjs.io/docs/en/api#testname-fn-timeout",children:"test/it"}),",\n",(0,t.jsx)(s.code,{children:"Test.producer"})," don't take a function where arbitrary logic and assertions can\ngo. ",(0,t.jsx)(s.code,{children:"Test.producer"})," takes an object as its argument, which has following properties:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"producer: producer"})})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.a,{href:"/docs/api/producer",children:"producer"})," function which you want to test."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"values: object"})})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"values"})," is an object that represent the first argument of the producer. We\ncan't call the producer directly to test it, ",(0,t.jsx)(s.code,{children:"values"})," is how we:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Provide arguments which producer gets from state (e.g using ",(0,t.jsx)(s.code,{children:"Observe.<path>"}),")"]}),"\n",(0,t.jsx)(s.li,{children:"Provide mocks for functions and other abstractions the producer uses"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["When the test is executed, the producer will get called with these ",(0,t.jsx)(s.code,{children:"values"})," as\nargument."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"expectations: { set: object, merge: object, remove: object }"})})}),"\n",(0,t.jsxs)(s.p,{children:["Expectations is an object to declare our the behavior of our expectations in a\ndeclarative manner. Unlike traditional jest tests, we can't make arbitrary\nassertions in our tests to ensure our producer behaves. ",(0,t.jsx)(s.code,{children:"expectations"})," is an\nobject with three properties which can assert three ways in which a producer\ncan impact the state:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"set: object"})})," asserts new values that producer adds to state"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"merge: object"})})," asserts changes in existing values in state that\nproducer has introduced"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"remove: object"})})," asserts values that producer has removed from the state"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.h2,{id:"testing-views",children:["Testing ",(0,t.jsx)(s.code,{children:"view"}),"s"]}),"\n",(0,t.jsxs)(s.p,{children:["Engine's ",(0,t.jsx)(s.code,{children:"view"}),"s are just producers with a significant specialty: they return\nJSX which gets rendered in, well, a view. ",(0,t.jsx)(s.code,{children:"@c11/engine.test"})," support testing\nviews with ",(0,t.jsx)(s.code,{children:"Test.view"})," function. For now, only ",(0,t.jsx)(s.a,{href:"https://jestjs.io/docs/en/snapshot-testing",children:"snapshot\ntesting"})," is supported to test views."]}),"\n",(0,t.jsx)(s.h3,{id:"testview",children:(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"Test.view"})})}),"\n",(0,t.jsxs)(s.p,{children:["Similar to ",(0,t.jsx)(s.code,{children:"Test.producer"}),", ",(0,t.jsx)(s.code,{children:"Test.view"})," is how individual tests of a\n",(0,t.jsx)(s.a,{href:"/docs/api/view",children:"view"}),"'s test suite are written."]}),"\n",(0,t.jsx)(s.p,{children:"Here's what a simple test for a view looks like:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-ts",children:'describe("TodoList view", () => {\n  Test.view("no list", {\n    state: {\n      todo: {\n        byId: {},\n      },\n    },\n    View: TodoList,\n    props: { icons: {} },\n  });\n});\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Just like ",(0,t.jsx)(s.code,{children:"Test.producer"}),", ",(0,t.jsx)(s.code,{children:"Test.view"})," do not accept a function for its second\nargument but an object to declare the test in a declarative manner."]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"state: Object"})})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"state"})," is the application state at the time when view is first rendered.\nTesting a view need access to the whole state because:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Child views might be accessing this state directly"}),"\n",(0,t.jsx)(s.li,{children:"Producers attached to the view (or its child views) might make changes to\nthe application state, which in turn impact the view"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"View: view"})})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"View"})," is the view itself that the test is being written for."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:(0,t.jsx)(s.code,{children:"props: object"})})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"props"})," is an object of props that parent view has passed down."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["This is all that is needed to test an Engine view. A call to ",(0,t.jsx)(s.code,{children:"Test.view"})," will\ntake a snapshot of how the view looks like when rendered in browser, and match\nit with the previously taken snapshot to ensure nothing has broken the view. You\ncan read more about ",(0,t.jsx)(s.a,{href:"https://jestjs.io/docs/en/snapshot-testing",children:"snapshot testing on Jest's\ndocumentation"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},9596:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>o});var t=n(7402);const i={},r=t.createContext(i);function c(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(r.Provider,{value:s},e.children)}}}]);